<!DOCTYPE html>
<html lang="en" ng-app="vdb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Tarique,Lijin,Xiaofo,John,Edward">

    <title>Visual Data Exploration</title>

    <!-- CSS libs -->
    <link href="dist/css/bootstrap.css" rel="stylesheet">
    <link href="dist/css/font-awesome.min.css" rel="stylesheet">
    <link href="dist/css/bootstrap-theme.min.css" rel="stylesheet" >
    <link href="assets/magicsuggest/magicsuggest-min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="custom.css" rel="stylesheet">
    <script src="js/globalvars.js"></script>

    <!-- Liraries required to load -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="assets/js/jquery.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	 <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>

    <!-- My External Files -->
    <script src="js/vdb.js"></script>

    <!-- Vega Files -->
    <script src="vega-master/examples/lib/d3.v3.min.js"></script>
    <script src="vega-master/vega.js"></script>

  </head>

  <body>
  <div class = "nav_before">
    <p id= "zenvisage">ZenVisage</p>
    <div class = "textbox">
    Please select dataset:
      <ul id="front_dataset">
        <li class="front_dataset" id="STUDENT">Student</li>
        <li class="front_dataset" id="INCOME">Income</li>
        <li class="front_dataset" id="REAL_ESTATE">Real Estate</li>
      </ul>
    </div>
  </div>

  <div id="everything">
    <div id="left-bar">
      <div id="sidebar" class="interface">
        <h4>
          ZenVisage
        </h4>
        <hr>
        <div>
          <h5 id="dataset-header">Datasets <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></h5>
          <ul id="dataset">
            <li class="dataset active" id="student">Student</li>
            <li class="dataset" id="income">Income</li>
            <li class="dataset" id="real_estate">Real Estate</li>
          </ul>
        </div>

        <hr>

        <div>
          <h5 id="category-list-header">Category <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></h5>
          <ul id="category-list">
          </ul>
        </div>

        <hr>

        <div>
          <h5 id="x-axis-header">X-axis <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></h5>
          <ul id="x-axis">
          </ul>
        </div>

        <hr>

        <div>
          <h5 id="y-axis-header">Y-axis <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></h5>
          <ul id="y-axis"></ul>
        </div>
        <hr>
		    <div class="info-text"><b>Aggregation Method</b></div>
        <div class="radio">
          <form>
            <input type="radio" name="aggregation-method" value="sum"><label>Sum</label><br>
            <input type="radio" name="aggregation-method" value="avg" checked><label>Average</label>
          </form>
        </div>
        <hr>
      </div> <!-- end side bar -->

      <div>
        <h5 id="predicate-column-header">Predicate <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></h5>
        <ul id="predicate-column"></ul>
      </div>

      <div class = "row">
       	<div class = "col-md-5">
          <div class="dropdown" >
          <button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown" onclick= "fillPredicateDropdown()">Value
          <span class="caret"></span></button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
            <li role="presentation"><a role="menuitem" tabindex="-1" id = "category"></a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" id = "xaxis"></a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" id = "yaxis"></a></li>
          </ul>
          </div>
        </div>
        <div class = "col-md-2">
          <select id="selection">
            <ul>
              <option><li class="operator active" id="="> = </li></option>
              <option><li class="operator" id="!="> != </li></option>
            </ul>
          </select>
        </div>

        <div class = "col-md-1"  id="predicate-value">
          <div>
            <input class="predicate-value" type="text" size = "10" name="predicate-value" value="" onchange = "onSubmit()">
          </div>
        </div>
      </div>
      <div class = "row"></div>
    </div> <!-- end left bar -->

    <div id="trend-bar">
      <div>
        <h5 id="exTrendTitle">Existing Trends <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></h5>
          <div class="btn-group" role="group" aria-label="..." id="changeButtons" style="visibility : hidden">
  			  <button type="button" class="btn btn-default" onclick = "changeExistingTrends(0)" id = "0">Column-A</button>
          <button type="button" class="btn btn-default" onclick = "changeExistingTrends(1)" id = "1">Column-B</button>
        </div>
        <div id="existing-trends"></div>
      </div>
    </div>

    <div id="right-bar">
      <br>
      <div class="info-text"><b>Select Search Method</b></div>
      <div class="radio">
        <form id="search-method">
          <input class="active" type="radio" name="search-method" value="SimilaritySearch" checked onclick=updateTrends()><label>Similarity Search</label><br>
          <input type="radio" name="search-method" value="Outlier" onclick=updateTrends()><label>Outlier Search</label>
        </form>
      </div>

      <hr>
  	  <div class = "checkbox">
  	  	<label><input type = "checkbox" id = "ignoreX" onclick=updateTrends()>Ignore X axis scale</label>
  	  </div>
  	  <div class = "checkbox">
  	  	<label><input type = "checkbox" id = "ignoreY" checked onclick=updateTrends()>Ignore Y axis scale</label>
  	  </div>

      <hr>
      <div id="num-results">
        <div class="info-text"><b>Number of Results</b></div>
        <div>
          <input class="num-results" type="text" name="number-of-results" value="5" onchange = "onSubmit()">
        </div>
      </div>
    </div> <!-- end right bar -->

    <div id="middle-bar">
      <div id="buttons">
        <div class = "row">
        	<div class = "col-md-5">
            <div class="btn-group" role="group" aria-label="...">
              <button type="button" class = "btn btn-default btn-xs" id = "line-1" >draw</button>
              <button type="button" class = "btn btn-default btn-xs" id = "modify-1">modify</button>
              <button type="button" class = "btn btn-default btn-xs" id = "clear-1">clear</button>
              <button type="button" class = "btn btn-default btn-xs" id = "rect" style= "display: none">rectangle</button>
              <button type="button" class = "btn btn-default btn-xs" id = "circle" style= "display: none">scatter</button>
              <button type="button" class = "btn btn-default btn-xs" id = " singlecircle" style= "display: none">circle</button>

            </div>
  	        <select id="sel">
  	          <option id ="lineChart" value="Line Chart">Line Chart</option>
  	          <!-- option id="barChart" value="Bar Chart">Bar Chart</option> -->
  	        </select>
          </div>
  		    <div class = "col-md-2" id="search-value">
            <div class="info-text"><b></b></div>

            <input class="search-value" type="text" size = "10" name="search-value" value="" onchange = "onSubmit()">

          </div>
          <!-- drawing tools for the second graph -->
          <div class = "col-md-5" style="visibility : hidden" id = "drawing-tool2"></div>
          <div class="btn-group" role="group" aria-label="...">
            <button type="button" class = "btn btn-default btn-xs" id = "line-2" >draw</button>
            <button type="button" class = "btn btn-default btn-xs" id = "modify-2">modify</button>
            <button type="button" class = "btn btn-default btn-xs" id = "clear-2">clear</button>
            <button type="button" class = "btn btn-default btn-xs" id = "rect" style= "display: none">rectangle</button>
            <button type="button" class = "btn btn-default btn-xs" id = "circle" style= "display: none">scatter</button>
            <button type="button" class = "btn btn-default btn-xs" id = " singlecircle" style= "display: none">circle</button>
          </div>
  	        <select id="sel">
  	          <option id ="lineChart" value="Line Chart">Line Chart</option>
  	          <!-- option id="barChart" value="Bar Chart">Bar Chart</option> -->
  	        </select>
        </div>
      </div>

      <div id="table">
        <table id="main-graph-area" class="table">
              <!-- Create Query -->
          <div class = "row">
          <tr>
            <!--  td id="firstDrawChartColumn" style="overflow: hidden;"-->
            <td id="firstDrawChartColumn">
              <div class="col-md-4" id = "blankChart" style="z-index:0; position:relative;">
                <div id = "draganddrop" ondrop="drop(event)" ondragover="allowDrop(event)" style="display:none;position: absolute;margin-top:6px;margin-left:60px;z-index:4 ;"></div>
                <canvas id="tools_sketch" style="display:block;position: absolute; margin-top:6px;margin-left:60px; z-index:1; "></canvas>
                <div id = "bar"><svg id="visualisation" style = "z-index:5; display:none; position: absolute;margin-top:6px;margin-left:60px;"></svg></div>

                <div id ="svgLayer" style="display:none;position: absolute;margin-top:5px; margin-left:60px; z-index:2;">
                  <svg id="mySvg" style="display:block" viewBox="0 0 409 210">
                    <path id = "myPath" d="" stroke="#14a9a1" stroke-width="3" fill="none" />
                    <circle id = "point0" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point1" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point2" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point3" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point4" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point5" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point6" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point7" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point8" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point9" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point10" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point11" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point12" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point13" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point14" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point15" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point16" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point17" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point18" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point19" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point20" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point21" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point22" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point23" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point24" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point25" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point26" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point27" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point28" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <circle id = "point29" class="userPoint" transform="translate(0,0)" r="0"></circle>
                    <!-- circle id = "point30" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point31" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point32" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point33" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point34" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point35" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point36" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point37" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point38" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point39" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point40" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point41" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point42" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point43" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point44" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point45" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point46" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point47" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point48" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point49" class="userPoint" transform="translate(0,0)" r="2"></circle>
                    <circle id = "point50" class="userPoint" transform="translate(0,0)" r="2"></circle-->

                  </svg>
                </div>
              </div>
              </td>
              <td style="vertical-align: middle">
                <button id="graphChanger" type="button" class="btn btn-default btn-sm" adder = "true">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
              </td>
              <td id="secondDrawChartColumn" class="secondDrawColumn">
                <div id = "blankChart1" ></div>
              <td >
              <td id="extraSpace">
              </td>
          <r-->
          <tr>
            <td id="axesChart0">
              <div id="x-axis-select-0"></div>
              <div id="y-axis-select-0"></div>

            </td>
            <td>
            </td>
            <td id="axesChart1" class="secondDrawColumn">
              <div id="x-axis-select-1"></div>
              <div id="y-axis-select-1"></div>

            </td>
            <td id="extraSpaceRow2">
            </td>
          </tr>
          </div>
        </table> <!-- row -->
      </div>

      <script> // REMEMBER TO MAKE ID DYNAMIC (EG 1,2,3)...
        //do vega
        var div = $("#blankChart1")
        div.hide();
        //var dragAndDrop = $("<div>", {id: "dragAndDrop1", width: div.width(), height: div.height()  })
        var dragAndDrop = $("<div id = 'draganddrop1' ondrop='drop1(event)' ondragover='allowDrop(event)' style='display:none;position: absolute;margin-top:6px;margin-left:60px;z-index:4'></div>")
        dragAndDrop.width(div.width())
        dragAndDrop.height(div.height())
        $("#blankChart1").append(dragAndDrop)
        var canvas = $('<canvas id="tools_sketch1" style="display:block;position: absolute; margin-top:6px;margin-left:60px; z-index:1; "></canvas>')
        //canvas.attr("width", div.width())
        //canvas.attr("height", div.height())
        $("#blankChart1").append(canvas)
        var barGraph = $('<div id = "bar1"><svg id="visualisation1" width="' + div.width() + '" height=" ' + div.height() + '" style = "z-index:5; display:none; position: absolute;margin-top:6px;margin-left:60px;"></svg></div>')
        $("#blankChart1").append(barGraph)

        var svgLayer = $('<div id ="svgLayer1" style="display:none;position: absolute;margin-top:6px; margin-left:60px; z-index:2;">')
          var mySvg =  $('<svg id="mySvg1" style="display:block" width="' + div.width() + '" height="' + div.height() + '" viewBox="0 0 ' + div.width() + ' ' + div.height() + '">')
            var path = $('<path id = "myPath1" d="" stroke="#14a9a1" stroke-width="3" fill="none" />')
            mySvg.append(path)
            for(var i = 0; i<30; i++){
              var point = $('<circle id = "point'+i+'-1" class="userPoint" transform="translate(0,0)" r="0"></circle>')
              mySvg.append(point)
            }
          svgLayer.append(mySvg)
        $("#blankChart1").append(svgLayer)

        $("#mySvg1").html($("#mySvg1").html()); //http://stackoverflow.com/questions/3642035/jquerys-append-not-working-with-svg-element
      </script>

      <div id="views" class="view">
      </div>

      <div class = "scrollbar" id="scrollbar">
    		<div class="force-overflow">
          <table id="views_table" class="table"></table>
        </div>
      </div>
    </div> <!-- end middle bar -->

</div> <!-- end everything -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script src="js/main.js"></script>
    <script src="js/rect.js"></script>

    <script src="js/smartdraw.js"></script>
    <script src="js/draganddrop.js"></script>
    <script src="dist/js/bootstrap.min.js"></script>

    <script src="dist/js/tooltip.js"></script>
    <script src="dist/js/underscore-min.js"></script>
    <script src="dist/js/underscore.string.min.js"></script>
    <script src="dist/js/backbone-min.js"></script>
    <script src="assets/magicsuggest/magicsuggest-min.js"></script>
    <script src="js/xdata.js"></script>

    <script src="js/generate-vega.js"></script>
    <script src="js/histogram.js"></script>
    <script>

    $.attrHooks['viewbox'] = {
        set: function(elem, value, name) {
            elem.setAttributeNS(null, 'viewBox', value + '');
            return value;
        }
    };

    function updateSizes(){
      var windowWidth = $("#middle-bar").width()
      var windowHeight = $("#middle-bar").height()
      drawGraphWidth = Math.round(windowWidth/3.2);
      if(graphChanger.attr("adder") == "true"){
          //one graph case
          drawGraphWidth = Math.round(windowWidth/1.3);
      }
      drawGraphHeight = Math.round(drawGraphWidth/2);

      resizeSketch(drawGraphHeight, drawGraphWidth); //when we resize, we should also resize the sketch
      resizePointsAndPath(drawGraphHeight, drawGraphWidth); //when we resize, we should also resize the path and points
      resizeResultsTable($("#scrollbar").height() , windowWidth);

      $("#firstDrawChartColumn").width(drawGraphWidth+100); //to support axis title (try to make this not fixed)
      $("#firstDrawChartColumn").height(drawGraphHeight+50); //to support the axis title
      $("#blankChart").width(drawGraphWidth);
      $("#blankChart").height(drawGraphHeight);
      $("#draganddrop").width(drawGraphWidth);
      $("#draganddrop").height(drawGraphHeight);
      $("#tools_sketch").width(drawGraphWidth);
      $("#tools_sketch").height(drawGraphHeight);
      $("#visualisation").width(drawGraphWidth); //for bar charts
      $("#visualisation").height(drawGraphHeight);
      $("#mySvg").width(drawGraphWidth);
      $("#mySvg").height(drawGraphHeight);
      $("#mySvg").attr("viewBox", "0 0 "+ drawGraphWidth + " " + drawGraphHeight);
      $("#x-axis-select-0").width(drawGraphWidth);
      $("#x-axis-select-0").height($("#x-axis-select-0").height());
      xAxisSelect0.input.width(0);
      $("#y-axis-select-0").width(drawGraphWidth);
      $("#y-axis-select-0").height($("#y-axis-select-0").height());

      yAxisSelect0.input.width(0);

      $("#secondDrawChartColumn").width(drawGraphWidth+100);
      $("secondDrawChartColumn").height(drawGraphHeight+50);
      $("#blankChart1").width(drawGraphWidth);
      $("#blankChart1").height(drawGraphHeight);
      $("#draganddrop1").width(drawGraphWidth);
      $("#draganddrop1").height(drawGraphHeight);
      $("#tools_sketch1").width(drawGraphWidth);
      $("#tools_sketch1").height(drawGraphHeight);
      $("#visualisation1").width(drawGraphWidth);
      $("#visualisation1").height(drawGraphHeight);
      $("#mySvg1").width(drawGraphWidth);
      $("#mySvg1").height(drawGraphHeight);
      $("#mySvg1").attr("viewBox", "0 0 "+ drawGraphWidth + " " + drawGraphHeight);
      $("#x-axis-select-1").width(drawGraphWidth);
      $("#x-axis-select-1").height($("#x-axis-select-1").height());

      xAxisSelect1.input.width(0);
      $("#y-axis-select-1").width(drawGraphWidth);
      $("#y-axis-select-1").height($("#y-axis-select-1").height());

      yAxisSelect1.input.width(0);
    }
    function resizeSketch(newHeight, newWidth){
        ctx.canvas.width = newWidth;
        ctx.canvas.height = newHeight;
        ctx1.canvas.width = newWidth;
        ctx1.canvas.height = newHeight;
        //
    }
    function resizePointsAndPath(newHeight, newWidth){
        //Resize blankChart
        var currHeight = $("#blankChart").height();
        var currWidth = $("#blankChart").width();
        //want map from 0 -> currHeight => 0 -> newHeight
        //eg 0 -> 10 => 0 -> 20. So 1(curr) -> 2 (new) = newHeight/currHeight
        var heightRatio = newHeight/currHeight;
        var widthRatio = newWidth/currWidth;
        //list contains the points of blankChart that form element myPath
        if(clickmodify){
            //drawTrend();
            if(chart0Information[4] == null){
                drawTrend(); //update chart1Information and drawData
            }
            else{
                drawData("", chart0Information, list, myPath);
            }
            updatelist("");
        }
        if($("#blankChart1").is(':visible')){ //If we are using the second drawing graph
            //list1 contains the points of blankChart1 that form element myPath
            if(clickmodify){
                //drawTrend1();
                if(chart1Information[4] == 0){
                    drawTrend1(); //update chart1Information and drawData
                }
                else{
                    drawData("1", chart1Information, list1, myPath1);
                }
                updatelist("1");
            }
        }
    }
    function resizeResultsTable(newHeight, newWidth){
        $("#scrollbar").width(newWidth);
        //$("#scrollbar").height(newHeight);
        //var height = $("#main-graph-area").height() + 2*(parseInt($("#main-graph-area").css("margin-bottom").replace("px", ""))
        //            + parseInt($("#main-graph-area").css("margin-top").replace("px", ""))) ;
        var height = $("#main-graph-area").height() + $("#buttons").height()+ 2*(parseInt($("#buttons").css("margin-bottom").replace("px", "")));
        $("#scrollbar").css('top', '' + height + 'px')
    }
    //Resizes the margins of the SVG and sketching divs to match the one created by vega
    //Needs to happen AFTER vega graphs get added (which is asyncronous)
    function resizeMargins(){
        var vega = $("#firstDrawChartColumn").find(".vega"); //finds the child div that contains all the vega
        var vegaWidth = vega.width();
        var vegaRealWidth = vega.children(":first").width(); //width including offset title
        //console.log("norm", vegaWidth, "real", vegaRealWidth)
        //var marginLeft = vegaRealWidth - vegaWidth;

	    //align svg, sketchpad with the chart
        var spec = createBlankNoScale("");
	    var fontsize = spec["axes"][1]["properties"]["title"]["fontSize"]["value"];
	    var titletochart = spec["axes"][1]["titleOffset"];
	    var result = fontsize+titletochart;
	    $("#tools_sketch").css( { "margin-left" : result} );
	    $("#svgLayer").css( { "margin-left" : result} );
	    $("#draganddrop").css( { "margin-left" : result} );


        vega = $("#secondDrawChartColumn").find(".vega");
        vegaWidth = vega.width();
        vegaRealWidth = vega.children(":first").width(); //width including offset title
        // marginLeft = vegaRealWidth - vegaWidth;
        //$("#tools_sketch1").css("margin-left", marginLeft);
        //$("#svgLayer1").css("margin-left", marginLeft);
        $("#tools_sketch1").css( { "margin-left" : result} );
	    $("#svgLayer1").css( { "margin-left" : result} );
	    //$("#draganddrop").css( { "margin-left" : result} );
    }
    </script>
    <script>
        var graphChanger;
        $(document).ready(function() {
            graphChanger = $("#graphChanger");
            updateSizes()
            updateDefaultModify();
            asyncronousVegaBlankCharts().done(function(){
                resizeResultsTable();
                resizeMargins();
            }); //needs to be resized after vega charts added
            getInterfaceFormData('student');
            //initialize formdata
            //getSuggestData(getSimilarTrendData());
            //getSuggestData(query)

            $("#secondDrawChartColumn").hide();
            $("#axesChart1").hide();
            $("#blankChart1").hide();

            graphChanger.click(function(){
              if(graphChanger.attr("adder") == "true"){
           	    for(var i = 0; i< 30; i++){		//these following lines hides the points
           	    	 var id = "point"+i;
            		 var myCir = document.getElementById(id);
             		 id = "point"+i +"-1";
             		 var myCir1 = document.getElementById(id);
             		 if(myCir != null ){
             		 	myCir.setAttribute("r", 0);
             		 	//$("#id").setAttribute("r", 0);
             		 }
             		 if(myCir1 != null){
             			myCir1.setAttribute("r", 0);
             		 }
           	    }
                var child = graphChanger.children(":first")
                child.attr("class", "glyphicon glyphicon-minus")
                graphChanger.attr("adder", "false")
                $("#secondDrawChartColumn").show();
                $("#axesChart1").show();
                $("#blankChart1").show();
                document.getElementById("changeButtons").style.visibility="visible";
                document.getElementById("drawing-tool2").style.visibility="visible";
              }
              else if(graphChanger.attr("adder") == "false"){
            	  for(var i = 0; i< 30; i++){		//this following lines hides the points
            	    	 var id = "point"+i;
             		 var myCir = document.getElementById(id);
              		 id = "point"+i +"-1";
              		 var myCir1 = document.getElementById(id);
              		 if(myCir != null ){
              		 	myCir.setAttribute("r", 0);
              		 	//$("#id").setAttribute("r", 0);
              		 }
              		 if(myCir1 != null){
              			myCir1.setAttribute("r", 0);
              		 }
            	    }

                var child = graphChanger.children(":first")
                child.attr("class", "glyphicon glyphicon-plus")
                graphChanger.attr("adder", "true")
                $("#secondDrawChartColumn").hide();
                $("#axesChart1").hide();
                $("#blankChart1").hide();
                document.getElementById("changeButtons").style.visibility="hidden";
                document.getElementById("drawing-tool2").style.visibility="hidden";
                changeExistingTrends(0);

              }
              updateSizes();
              //updateDefaultModify(); do we need this?? it zero all the points!!! so after pressing the adder, our old list of points are gone!:(
              asyncronousVegaBlankCharts().done(function(){
                  resizeResultsTable();
                  resizeMargins();
              });
              existingTrends[1] = existingTrends[0];
              updateTrends();
            });
        });
      $(window).resize(function(){
          updateSizes()
          //updateDefaultModify();
          asyncronousVegaBlankCharts().done(function(){
              resizeResultsTable();
              resizeMargins();
          });

          existingTrends[1] = existingTrends[0];
          updateTrends();
      });
      //Calls vega to update the blank charts. Only returns as DONE if both blank charts are done being created by vega
      function asyncronousVegaBlankCharts(){
          var dfrd1 = $.Deferred();
          var dfrd2 = $.Deferred();

        blankChartAsync(" ","").done(function(){
            if(chart0Information != null && chart0Information[4]!= null){
            changeScaleBlankChart( chart0Information[0] , chart0Information[1] , chart0Information[2] ,
                 chart0Information[3], chart0Information[4], "");
             }
            dfrd1.resolve();
        });
        blankChartAsync(" ","1").done(function(){
            if(chart1Information != null && chart1Information[4] != null){
            changeScaleBlankChart( chart1Information[0] , chart1Information[1] , chart1Information[2] ,
                 chart1Information[3], chart1Information[4], "1");
             }
            dfrd2.resolve();
        });
         return $.when(dfrd1, dfrd2).done(function(){
                //console.log('Both vega graphs updated');
            }).promise();
    }
    </script>
    <script>
      function isGraphVisible(suffix){
        return $('#blankChart'+suffix).css('display') == 'block'
      }
    </script>
    <script>
          var scriptChangedX0 = true;
          var scriptChangedX1 = true;
          var scriptChangedY0 = true;
          var scriptChangedY1 = true;

          var xAxisSelect0 = $('#x-axis-select-0').magicSuggest({maxSelection :1, toggleOnClick:true, infoMsgCls: "axesInput" });
          var xAxisSelect1 = $('#x-axis-select-1').magicSuggest({maxSelection :1, toggleOnClick:true, infoMsgCls: "axesInput"});

          var yAxisSelect1 = $('#y-axis-select-1').magicSuggest({maxSelection :1, toggleOnClick:true, infoMsgCls: "axesInput"  });
          var yAxisSelect0 = $('#y-axis-select-0').magicSuggest({maxSelection :1, toggleOnClick:true, infoMsgCls: "axesInput"});


      $(xAxisSelect1).on('selectionchange', function(e,m){
    	  if (isGraphVisible("1")) {
      	  	ExTrendindex = 1;
      	  }
        if(!scriptChangedX1){
          if(xAxisSelect1.getValue().length == 1) {
            //onSubmit();
            var x0Value = JSON.stringify(xAxisSelect0.getValue());
            var x1Value = JSON.stringify(xAxisSelect1.getValue());
            var y0Value = JSON.stringify(yAxisSelect0.getValue());
            var y1Value = JSON.stringify(yAxisSelect1.getValue());
        	  if (x0Value != x1Value || y0Value != y1Value) {
     				updateOneTrend("1");
        	  }
        	  else { // copy existing trend and change
        		  existingTrends[1] = existingTrends[0];
        		  changeExistingTrends(1);
        	  }
          }

        }
          scriptChangedX1 = false;
      });

      $(yAxisSelect1).on('selectionchange', function(e,m){
    	  //console.log("y1 selection change");
    	  //setTimeout(function() {
    	  if (isGraphVisible("1")) {
    	  	ExTrendindex = 1;
    	  }
        if(!scriptChangedY1){
          if(yAxisSelect1.getValue().length == 1) {
            //onSubmit();
            var x0Value = JSON.stringify(xAxisSelect0.getValue());
            var x1Value = JSON.stringify(xAxisSelect1.getValue());
            var y0Value = JSON.stringify(yAxisSelect0.getValue());
            var y1Value = JSON.stringify(yAxisSelect1.getValue());
        	  if (x0Value != x1Value || y0Value != y1Value) {
        		  updateOneTrend("1");
        	  }
        	  else { // copy existing trend and change
        		  existingTrends[1] = existingTrends[0];
        		  changeExistingTrends(1);
        	  }
          }
        }
        scriptChangedY1 = false;
    	  //  }, 0)
      });

      $(xAxisSelect0).on('selectionchange', function(e,m){
      	ExTrendindex = 0;
          if(!scriptChangedX0){
            if(xAxisSelect0.getValue().length == 1) {//exactly one value in combobox
            	 var x0Value = JSON.stringify(xAxisSelect0.getValue());
                 var x1Value = JSON.stringify(xAxisSelect1.getValue());
                 var y0Value = JSON.stringify(yAxisSelect0.getValue());
                 var y1Value = JSON.stringify(yAxisSelect1.getValue());
             	  if (x0Value != x1Value || y0Value != y1Value) {
             		 updateOneTrend("");
             	  }
             	 else { // copy existing trend and change
           		  existingTrends[0] = existingTrends[1];
           		  changeExistingTrends(0);
           	  }

            }
          }
          scriptChangedX0 = false;
        });

      $(yAxisSelect0).on('selectionchange', function(e,m){
    	  //console.log("y0 selection change");
    	ExTrendindex = 0;
        if(!scriptChangedY0){
          if(yAxisSelect0.getValue().length == 1) {
        	  var x0Value = JSON.stringify(xAxisSelect0.getValue());
              var x1Value = JSON.stringify(xAxisSelect1.getValue());
              var y0Value = JSON.stringify(yAxisSelect0.getValue());
              var y1Value = JSON.stringify(yAxisSelect1.getValue());
          	  if (x0Value != x1Value || y0Value != y1Value) {
          		updateOneTrend("");
          	  }
          	else { // copy existing trend and change
      		  existingTrends[0] = existingTrends[1];
      		  changeExistingTrends(0);
      	  }

          }
        }
        scriptChangedY0 = false;
      });


    </script>
  </body>
</html>
